program classof;
//uses
// __mla__internaltypes;
type
 ttest = class()[virtual]
  f1,f2: int32;
  class method newinstance(): pointer [new,virtual];
  constructor create();
  destructor destroy();
  class method test();
 end;
 ttest1 = class(ttest)
  f3: int32;
  class method newinstance(): pointer;// [override];
  method ini() [ini];
 end;
constructor ttest.create();
begin
end;

destructor ttest.destroy();
begin
end;

class method ttest.newinstance(): pointer;
begin
 writeln(sizeof(self^));
 result:= getmem(sizeof(self^));
{$internaldebug on}
 initialize(result,self);
end;

class method ttest1.newinstance(): pointer;
begin
 result:= inherited newinstance();
 ttest1(result).f3:= 123;
end;

class method ttest.test();
begin
end;

method ttest1.ini();
begin
 writeln('ini');
end;

type
 tty = class of ttest;
 procty = method();
var
 c1: ttest;
 t1: tty;
 c2: ttest;
 p1: pointer;
 proc1: procty;
begin
{$internaldebug on}
 c2:= ttest1.create();
// writeln(sizeof(c2);
 writeln(sizeof(c2^);
// exitcode:= sizeof(c2);
 writeln(c2);
 c2.destroy();
end.